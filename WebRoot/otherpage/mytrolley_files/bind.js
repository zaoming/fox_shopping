/* SVN.committedRevision=373325 */
var deadLine=60;var menuImagePath=URLPrefix.my_statics||"http://image.yihaodianimg.com/member";function timeToDeadLine(){if(jQuery("#timeToDeadLine").length>=1){if(deadLine!=0){jQuery("#timeToDeadLine").html("("+deadLine+"秒后)重新获取短信");deadLine--;setTimeout("timeToDeadLine()",1000)}else{jQuery("#timeToDeadLine").html("重新获取短信");jQuery("#timeToDeadLine").removeClass();jQuery("#timeToDeadLine").addClass("btn_org");jQuery("#timeToDeadLine").bind("click",sendSMS)}}}function check_mobile(){var a=jQuery("#verifyMobile").val();if(a==""){YHD.alert("请输入手机号码!");return false}var b=/^\d{11}$/;if(!b.test(a)){YHD.alert("手机号码不正确!");return false}return true}function needBind(){var a=URLPrefix.my+"/member/bind/needBind.do?callback=?";jQuery.getJSON(a,function(b){if(b&&b.result){if(b.result=="alreadyvalidate"){showStep4(b.cellphone)
}if(b.result=="needvalidate"){showStep1()}}else{showStep1()}})}function sendSMS(){if(check_mobile()){var a=URLPrefix.my+"/member/bind/finishBind.do?cellphone="+jQuery("#verifyMobile").val()+"&callback=?";jQuery.getJSON(a,function(b){if(b&&b.result){if(b.result=="success"){showStep2(b.cellphone)}if(b.result=="cellphone number is null"){YHD.alert("请输入正确的手机号码！");showStep1()}if(b.result=="overflow times"){YHD.alert("您今天尝试的次数过多，请明天再来！")}if(b.result=="too fast"){YHD.alert("2次发送短信的间隔不能小于1分钟，请稍后再来尝试！");showStep1()}if(b.result=="phonenum is exists"){YHD.alert("您输入的手机号码已经被其他用户绑定，请换一个号码再试！");showStep1()}if(b.result=="alreadyvalidate"){YHD.alert("您已经绑定过了手机，无需再次绑定！");showStep4(data.cellphone)}}else{YHD.alert("系统错误！")}})}else{YHD.alert("请输入正确的手机号码！",showStep1)}}function finishBind(){var a=URLPrefix.my+"/member/bind/successBind.do?cellphone="+jQuery("#verifyMobile").val()+"&smsValidateCode="+jQuery("#vCode").val()+"&callback=?";
jQuery.getJSON(a,function(b){if(b&&b.result){if(b.result=="success"){showStep3(b.cellphone)}if(b.result=="cellphone number is null"){YHD.alert("请输入正确的手机号码！");showStep1()}if(b.result=="wrong times"){YHD.alert("尝试的错误次数过多，请重新发送验证码！");showStep1()}if(b.result=="validateCode is null"){YHD.alert("请输入验证码！");showStep1()}if(b.result=="alreadyvalidate"){YHD.alert("您已经绑定过了手机，无需再次绑定！")}if(b.result=="phonenum is exists"){YHD.alert("您输入的手机号码已经被其他用户绑定，请换一个号码再试！");showStep1()}if(b.result=="validate code is expired"){YHD.alert("验证码已经过期，系统重新发送了一个验证码到您的手机，请注意查收！");sendSMS()}if(b.result=="incorrect code"){YHD.alert("验证码错误，请重新输入。")}if(b.result=="incorrect userId"){YHD.alert("系统错误！")}if(b.result=="update status error"){YHD.alert("系统错误！")}}else{YHD.alert("系统错误！")}})}function writeCSS(){cssLink=document.createElement("link");
cssLink.type="text/css";cssLink.rel="stylesheet";cssLink.href=menuImagePath+"/member/css/bind.css";document.getElementsByTagName("head")[0].appendChild(cssLink)}function showStep1(){var a="";a+="<div class='step'>";a+="<span class='curr org_arrow'>1.输入要绑定的手机号码</span>";a+="<span class='grey_arrow'>2.输入短信验证码完成绑定</span>";a+="<span>3.手机绑定成功</span>";a+="</div>";a+="<div class='mobile_bindbox bd_btm'>";a+="<span class='grey3'>绑定手机号码：</span><input type='text' id='verifyMobile' class='ipt w200 curr_ipt198'/>";a+="<p class='tc'><a href='###' id='next' class='btn'>下一步</a></p>";a+="<div class='instruc_box'>";a+="<p>请您输入正确的手机号码以便接收绑定短信验证码，完成下一步操作。</p>";a+="<p>一个手机号码只能绑定一个账号。</p>";a+="<p class='grey6'><span>·</span>绑定手机不收任何费用请您放心使用。</p>";a+="<p class='grey6'><span>·</span>为了您的账号安全，绑定成功后，请不要随意修改联系方式。</p>";
a+="</div>";a+="</div>";a+="<p class='grey6 ml30'><b>何时需要手机绑定?</b></p>";a+="<p class='grey6 ml30'>1.首次使用抵用券手机验证时，会将该手机号与账号自动绑定，手机绑定后不可解绑。</p><BR/>";a+="<p class='grey6 ml30'><b>手机绑定有何作用？</b></p>";a+="<p class='grey6 ml30'>1.可将手机号码同时作为登录账号，并可用手机找回密码。</p>";a+="<p class='grey6 ml30'>2.对于任何抵用券，无需再次验证手机，可直接使用。</p>";jQuery("#bindDiv").html(a);jQuery("#next").bind("click",sendSMS)}function showStep2(b){var a="";a+="<div class='step'>";a+="<span class='grey_arrow2'>1.输入要绑定的手机号码</span>";a+="<span class='curr org_arrow'>2.输入短信验证码完成绑定</span>";a+="<span>3.手机绑定成功</span>";a+="</div>";a+="<div class='mobile_bindbox'>";a+="<ul>";a+="<li><span class='grey3'>您当前要绑定的手机号码：</span><span class='orange'>"+b+"</span><input type='hidden' id='verifyMobile' value='"+b+"'/><a href='javascript:void(0);' onClick='showStep1();'>[修改号码]</a></li>";
a+="<li><span class='grey3'>校验码：</span><input type='text' class='ipt w98 curr_ipt98' id='vCode'/><p class='grey9'>校验码是6位数字</p></li>";a+="</ul>";a+="<div class='instruc_box w400'>";a+='<p>如果1分钟内没有收到校验短信，您可以通过"重新获取短信"重新获取校验码</p>';a+="<p>一个账号一天最多可以获取5次验证码</p>";a+="<button id='timeToDeadLine' class='btn_grey'>(60秒后)重新获取短信</button>";a+="</div>";a+="<p class='tc'><button class='btn' id='finishBind'>完成绑定</button></p>";a+="</div>";jQuery("#bindDiv").html(a);jQuery("#finishBind").bind("click",finishBind);timeToDeadLine()}function showStep3(b){var a="";a+="<div class='step'>";a+="<span>1.输入要绑定的手机号码</span>";a+="<span class='grey_arrow2'>2.输入短信验证码完成绑定</span>";a+="<span class='curr'>3.手机绑定成功</span>";a+="</div>";a+="<div class='mobile_sucessbox'>";a+="<strong>恭喜您！手机绑定成功！</strong>";a+="<p>您绑定的手机号码：<span class='grey3'>"+b+"</span></p>";
a+="</div>";jQuery("#bindDiv").html(a);jQuery("#next").bind("click",sendSMS)}function showStep4(b){var a="";a+="<div class='mobile_bind'>";a+="<strong>您的手机已绑定！</strong>";a+="<p>您绑定的手机号码：<span class='grey3'>"+b+"</span></p>";a+="</div>";jQuery("#bindDiv").html(a);setTimeout("hiddenBindDiv",3000)}function hiddenBindDiv(){jQuery("#bindDiv").hide()}function initBind(){writeCSS();needBind()}if((window.location.protocol+"//"+window.location.hostname+window.location.pathname).indexOf("member/bind/bind.do")!=-1){initBind()};