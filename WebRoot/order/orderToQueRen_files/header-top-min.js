var TB=TB||{};TB.Header=function(){var c=KISSY,i=c.DOM,h=c.Event,d=window,g=document,f=(d.g_config||0).appId===6;function e(N,M){var n=c.get("#"+N),B=n&&n.q,l=n&&n.search_type,v=n&&n.getElementsByTagName("label")[0],u=n&&n.cat,J=c.get("#J_TSearchTabs").getElementsByTagName("li"),j=J.length,G={},z=false,w=false,m="tsearch-tabs-active",r="tsearch-tabs-hover",E=function(O){for(var q=0;q<j;q++){i[q===O?"addClass":"removeClass"](J[q],m)}},I=c.get("#J_TSearchCat"),L=null,k=c.get("#J_TSearchCatHd"),p=I&&I.getElementsByTagName("div")[0],t=p&&p.getElementsByTagName("a")||[],y=t.length,H,x=function(q){for(H=0;H<y;H++){if(t[H].getAttribute("data-value")===q){return t[H]}}return null},D=function(){i.removeClass(I,"tsearch-cat-active")},K=function(){i.addClass(I,"tsearch-cat-active")},C=function(q){for(H=0;H<y;H++){i[t[H]===q?"addClass":"removeClass"](t[H],"tsearch-cat-selected")}D();k.innerHTML=q.innerHTML;u.value=q.getAttribute("data-value")},A=function(){B.focus();if(c.UA.ie){B.value=B.value}};if(!n){return}if(c.get("#J_TSearchTabs")){var F=0,s={"\u5b9d\u8d1d":["item","\u8f93\u5165\u60a8\u60f3\u8981\u7684\u5b9d\u8d1d"],"\u6dd8\u5b9d\u5546\u57ce":["mall","\u8f93\u5165\u60a8\u60f3\u8981\u7684\u5546\u54c1"],"\u5e97\u94fa":["shop","\u8f93\u5165\u60a8\u60f3\u8981\u7684\u5e97\u94fa\u540d\u6216\u638c\u67dc\u540d"],"\u62cd\u5356":["auction","\u8f93\u5165\u60a8\u60f3\u8981\u7684\u5b9d\u8d1d"],"\u6dd8\u5427":["taoba","\u8f93\u5165\u60a8\u60f3\u8981\u641c\u7d22\u7684\u5185\u5bb9"],"\u5b9d\u8d1d\u5206\u4eab":["share","\u8f93\u5165\u60a8\u60f3\u8981\u7684\u5b9d\u8d1d"]},o={"\u5bf6\u8c9d":["item","\u8f38\u5165\u60a8\u60f3\u8981\u7684\u5bf6\u8c9d"],"\u6dd8\u5bf6\u5546\u57ce":["mall","\u8f38\u5165\u60a8\u60f3\u8981\u7684\u5546\u54c1"],"\u5e97\u92ea":["shop","\u8f38\u5165\u60a8\u60f3\u8981\u7684\u5e97\u8216\u540d\u6216\u638c\u6ac3\u540d"],"\u62cd\u8ce3":["auction","\u8f38\u5165\u60a8\u60f3\u8981\u7684\u5bf6\u8c9d"],"\u6dd8\u5427":["taoba","\u8f38\u5165\u60a8\u60f3\u8981\u641c\u7d22\u7684\u5167\u5bb9"],"\u5bf6\u8c9d\u5206\u4eab":["share","\u8f38\u5165\u60a8\u60f3\u8981\u7684\u5bf6\u8c9d"]};for(;F<j;F++){(function(){var P=F,q=c.trim(J[P].getElementsByTagName("a")[0].innerHTML),O=s[q]||o[q];if(!O){return}G[O[0]]={index:P,hint:O[1]};h.on(J[P],"click",function(Q){Q.halt();E(P);i.removeClass(J[P],r);l.value=O[0];v.innerHTML=O[1];A()});h.on(J[P],"mouseenter",function(Q){Q.halt();if(!i.hasClass(J[P],m)){i.addClass(J[P],r)}});h.on(J[P],"mouseleave",function(Q){Q.halt();if(!i.hasClass(J[P],m)){i.removeClass(J[P],r)}})})()}}h.on(B,"focus",function(){v.innerHTML="";i.addClass(v,"hidden")});h.on(B,"blur",function(){if(c.trim(B.value)===""&&!z){v.innerHTML=G[l.value]["hint"];i.removeClass(v,"hidden")}});h.on("#J_TSearchTabs","mousedown",function(){z=true;w=true;setTimeout(function(){z=false})});h.on("#J_TSearchCat","click",function(q){q.halt();var O=q.target;switch(true){case i.hasClass(O.parentNode,"tsearch-cat-hd"):case i.hasClass(O,"tsearch-cat-hd"):K();break;case O.parentNode.nodeName.toLowerCase()==="div":C(O);A();break}});h.on(document,"click",D);h.on(n,"submit",function(){switch(n.search_type.value){case"item":if(B.value===""){n.action="http://list.taobao.com/browse/cat-0.htm"}break;case"mall":n.action="http://list.tmall.com/search_product.htm";break;case"shop":n.action="http://shopsearch.taobao.com/browse/shop_search.htm";break;case"auction":n.atype.value="a";break;case"taoba":n.action="http://ba.taobao.com/index.htm";break;case"share":n.tracelog.value="msearch2fx";if(B.value===""){n.action="http://jianghu.taobao.com/square.htm"}else{n.keyword.value=B.value;n.action="http://fx.taobao.com/view/share_search.htm"}break}});v.innerHTML="";setTimeout(function(){if(!w){l.value=(M&&M.searchType)?M.searchType:"item";if(document.domain.indexOf("shopsearch.taobao.com")>-1){l.value="shop"}var q=G[l.value];v.innerHTML=q.hint;E(q.index)}if(I&&(L=x(u.value))){C(L)}if(c.trim(B.value)!==""){v.innerHTML=""}if(M&&M.autoFocus){A()}n.atype.value="";if(n.keyword){n.keyword.value=""}if(n.tracelog){n.tracelog.value=""}})}function b(t){var l=c.get("#"+t);if(!l){return}var j=l.q;if(!j){return}if(!(window.TB&&TB.Suggest||c.Suggest)){return}var m=c.Suggest?c:TB,s=new m.Suggest(j,"http://suggest.taobao.com/sug",{resultFormat:"\u7ea6%result%\u4e2a\u5b9d\u8d1d"});var k=l.ssid;if(k){setTimeout(function(){k.value="s5-e"},0);k.setAttribute("autocomplete","off");var n=function(){if(k.value.indexOf("-p1")==-1){k.value+="-p1"}};try{if(s.subscribe){s.subscribe("onItemSelect",n)}if(s.on){s.on("onItemSelect",n)}}catch(p){}}var r=l.elements.search_type;var u=function(){return r.value};var o=s._needUpdate;s._needUpdate=function(){var q=u();return(q==="item"||q==="mall")&&o.call(s)}}function a(){if(document.domain.indexOf(".taobao.net")===-1){return}var m=document.getElementById("header"),l=m?m.getElementsByTagName("a"):[],k=0,j=l.length,n=location.hostname.split(".");while(n.length>3){n.shift()}n=n.join(".");for(;k<j;k++){l[k].href=l[k].href.replace("taobao.com",n)}}return{init:function(j){a();if(c.get("#J_TSearch")){e("J_TSearchForm",j);if(!f){setTimeout(function k(){if(typeof k.count=="undefined"){k.count=0}k.count++;if(!(window.TB&&TB.Suggest||c.Suggest)){setTimeout(arguments.callee,200)}else{b("J_TSearchForm")}},200)}}}}}();
