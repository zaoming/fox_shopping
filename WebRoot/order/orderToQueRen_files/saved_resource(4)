/*publish time:2011-08-11 10:27:03*/
var TB=YAHOO.namespace("TB");YAHOO.namespace("TB.app.Trade");YAHOO.lang.augmentObject(TB.app.Trade,function(){var Y=YAHOO.util,Dom=Y.Dom,Event=Y.Event,G=Y.Get,C=YAHOO.util.Connect;var Trade=TB.app.Trade;return{ListSelector:function(containerId){var obj={checkCount:0,selectors:[],allSelectors:[],MAX_COUNT:0,ALL_COUNT:0,init:function(containerId){this.selectors=Dom.getElementsByClassName("selector","input",containerId);this.allSelectors=Dom.getElementsByClassName("all-selector","input",containerId);this.MAX_COUNT=this.selectors.length;this.ALL_COUNT=this.allSelectors.length;this.initAllSelectors();this.initSelectors()},initAllSelectors:function(){Dom.batch(this.allSelectors,function(el){Event.on(el,"click",function(){var isChecked=this.checked;obj.checkedCount=isChecked?obj.MAX_COUNT:0;for(var i=0;i<obj.MAX_COUNT;++i){obj.selectors[i].checked=isChecked}for(i=0;i<obj.ALL_COUNT;++i){obj.allSelectors[i].checked=isChecked}})})},initSelectors:function(){Dom.batch(this.selectors,function(el){Event.on(el,"click",function(){if(!el.checked){for(var i=0;i<obj.ALL_COUNT;++i){obj.allSelectors[i].checked=false}obj.checkedCount--}else{obj.checkedCount++;if(obj.checkedCount==obj.MAX_COUNT){for(i=0;i<obj.ALL_COUNT;++i){obj.allSelectors[i].checked=true}}}})})}};obj.init(containerId);return obj},DialogMgr:{currentDialog:null,currentTrigger:null,initTriggers:function(container){var triggers=Dom.getElementsByClassName("J_DialogTrigger","*",container||document.body);var obj=this;for(var i=0,len=triggers.length;i<len;++i){Event.on(triggers[i],"click",function(ev){Event.preventDefault(ev);var url=this.href;var config=Trade.Util.parseQueryString(this.getAttribute("data"));obj.currentTrigger=this;Trade.DialogMgr.showDialog(url,config)})}},initDialogCloseBtn:function(){Event.on("J_ContainerClose","click",function(){parent.TB.app.Trade.DialogMgr.hideDialog()})},initDialog:function(config){config=config||{};config.width=config.width||"690px";config.height=config.height||"280px";config.visible=config.visible||false;config.modal=config.modal!==false;config.draggable=config.draggable||false;config.close=config.close!==false;var dialogId="J_Dialog";var layer=Dom.get(dialogId);layer=document.createElement("div");layer.id=dialogId;Dom.addClass(layer,"dialog");var iframe=document.createElement("iframe");iframe.name="dialogFrame";iframe.style.width=(parseInt(config.width)-20)+"px";iframe.style.height=(parseInt(config.height)-20)+"px";iframe.setAttribute("frameBorder","0");iframe.setAttribute("scrolling","no");iframe.src="about: blank";var bd=document.createElement("div");Dom.addClass(bd,"bd");bd.appendChild(iframe);layer.appendChild(bd);document.body.appendChild(layer);document.body.appendChild(layer);this.currentDialog=new YAHOO.widget.Panel(layer,config);this.currentDialog.render();Dom.addClass(document.body,"yui-skin-sam");var closeBtn=Dom.getElementsByClassName("container-close","a",layer);if(closeBtn.length==1){closeBtn=closeBtn[0];Event.purgeElement(closeBtn);Event.on(closeBtn,"click",function(ev){Event.preventDefault(ev);this.hideDialog()},this,true)}var current=this;recalcTimer=null;Event.on(window,"resize",function(){if(null!==recalcTimer){recalcTimer.cancel()}recalcTimer=YAHOO.lang.later(200,this,function(){current.currentDialog.center()})})},showDialog:function(url,config){if(!this.currentDialog){this.initDialog(config)}if(url.indexOf("?")==-1){url+="?"}url+="&t="+(new Date()).getTime();Dom.get("J_Dialog").getElementsByTagName("iframe")[0].src=url;this.currentDialog.center();this.currentDialog.show();$("card_info").className="covered"},hideDialog:function(confirmClose){if(typeof confirmClose=="undefined"){confirmClose=false}if(confirmClose){var ok=confirm("\u786e\u8ba4\u5173\u95ed\u7a97\u53e3\u4e48\uff1f");if(!ok){return false}}$("card_info").className="";Event.purgeElement(window,false,"resize");Dom.get("J_Dialog").getElementsByTagName("iframe")[0].src="about:blank";this.currentDialog.hide();var dialog=Dom.get("J_Dialog_c");var dialogMask=Dom.get("J_Dialog_mask");var resizeMonitor=Dom.get("_yuiResizeMonitor");dialog.parentNode.removeChild(dialog);dialogMask.parentNode.removeChild(dialogMask);resizeMonitor.parentNode.removeChild(resizeMonitor);this.currentDialog=null}},TradeOperations:{ModifyPrice:function(form){form=Dom.get(form);if(!form){return }var originalPrice=parseFloat(Dom.get("J_OriginalPrice").innerHTML);var postFeeEl=Dom.get("J_PostFee");var adjustFeeEl=Dom.get("J_AdjustFee");var totalPriceEl=Dom.get("J_TotalPrice");var errorMsg=Dom.get("J_ErrorMsg");var adjustFeeInputs=form.elements.adjustFee;var postFeeInput=form.elements.postFee;var totalAdjustFeeInitEl=Dom.get("J_InitAdjustFee");var totalAdjustFeeInitVal=0;if(totalAdjustFeeInitEl){totalAdjustFeeInitVal=parseFloat(totalAdjustFeeInitEl.getAttribute("data-value"))}var hasDiscount=!!form.elements.discount;if(hasDiscount){var discountData=form.elements.discount;var discountValue=discountData.getAttribute("data-value")}var frmInputs=[];if(!adjustFeeInputs.length){adjustFeeInputs=[adjustFeeInputs]}for(var i=0,len=adjustFeeInputs.length;i<len;++i){frmInputs.push(adjustFeeInputs[i])}frmInputs.push(postFeeInput);Event.on(frmInputs,"blur",function(){if(!validateInputs()){return }try{var postFee=parseFloat(postFeeInput.value).toFixed(2);postFeeEl.innerHTML=postFee;var totalAdjustFee=totalAdjustFeeInitVal;for(var i=0,len=adjustFeeInputs.length;i<len;++i){var val=YAHOO.lang.trim(adjustFeeInputs[i].value);totalAdjustFee+=parseFloat(val)}var totalAdjustFeeStr="";if(totalAdjustFee<0){totalAdjustFeeStr="- "+Math.abs(totalAdjustFee).toFixed(2)}else{totalAdjustFeeStr="+ "+Math.abs(totalAdjustFee).toFixed(2)}adjustFeeEl.innerHTML=totalAdjustFeeStr;var price=parseFloat(originalPrice)+parseFloat(postFee)+parseFloat(totalAdjustFee);if(hasDiscount){price-=discountValue}if(price<=0){Dom.removeClass(errorMsg,"hidden")}else{Dom.addClass(errorMsg,"hidden")}totalPriceEl.innerHTML=price.toFixed(2)}catch(e){Dom.removeClass(errorMsg,"hidden")}});Event.on(form,"submit",function(ev){if(!Dom.hasClass(errorMsg,"hidden")){Event.preventDefault(ev);Trade.Util.twinkleErrorBox(errorMsg)}});Event.on(frmInputs,"input",checkFraction);Event.on(frmInputs,"propertychange",checkFraction);function checkFraction(){var val=String(this.value);var p=val.lastIndexOf(".");if(p<0||val.length<p+1){return }var frac=val.substring(p+1);if(frac.length>2){this.value=val.substring(0,p)+"."+frac.substring(0,2)}}function validateInputs(){for(var i=0,len=frmInputs.length;i<len;++i){var input=frmInputs[i];var val=YAHOO.lang.trim(input.value);if(val==""){input.value="0";val=0}if(parseFloat(val)!=val){Dom.removeClass(errorMsg,"hidden");input.focus();return false}}var postFeeValue=YAHOO.lang.trim(postFeeInput.value);if(parseFloat(postFeeValue)<0){Dom.removeClass(errorMsg,"hidden");postFeeInput.focus();return false}return true}},CancelOrder:function(form){form=Dom.get(form);if(!form){return }Event.on(form,"submit",function(ev){if(Dom.get("J_CloseReason").selectedIndex==0){Event.preventDefault(ev);Dom.removeClass("J_ErrorMsg","hidden");Trade.Util.twinkleErrorBox("J_ErrorMsg")}})}},Callback:{CommonOperation:function(){Trade.DialogMgr.hideDialog();if(Dom.get("list-sold-items")!=document.body){window.location.reload();return true}return false},ModifyPrice:function(orderId,orderPrice,postFee){if(this.CommonOperation()){return }if(!orderId){return }var order=Dom.get("order"+orderId);if(!order){return }var orderPriceEl=Dom.getElementsByClassName("J_OrderPrice","",order)[0];if(orderPriceEl&&typeof (orderPrice)!="undefined"){orderPriceEl.innerHTML="";orderPriceEl.appendChild(document.createTextNode(orderPrice))}var postFeeEl=Dom.getElementsByClassName("J_PostFee","",order)[0];if(postFeeEl&&typeof (postFee)!="undefined"){postFeeEl.innerHTML="";postFeeEl.appendChild(document.createTextNode(postFee))}},CloseTrade:function(orderId){if(this.CommonOperation()){return }if(!orderId){return }var order=Dom.get("order"+orderId);if(!order){return }var tradeStatus=Dom.getElementsByClassName("trade-status","",order)[0];if(tradeStatus){tradeStatus.innerHTML='<strong class="closed">\u4ea4\u6613\u5173\u95ed<strong>'}var tradeActions=Dom.getElementsByClassName("trade-actions","",order)[0];if(tradeActions){var complainBtn=Dom.getElementsByClassName("J_ComplainBtn","a",tradeActions)[0];var html="";if(complainBtn){html=complainBtn.parentNode.innerHTML;html='<span class="skin-gray">'+html+"</span>"}tradeActions.innerHTML=html}},DelayTrade:function(orderId){if(this.CommonOperation()){return }if(!orderId){return }var order=Dom.get("order"+orderId);if(!order){return }alert("\u6210\u529f\u5ef6\u957f\u8ba2\u5355 "+orderId+" \u7684\u8d85\u65f6\u65f6\u95f4\u3002")}},Util:{togglePanel:function(trigger,panel,callback){trigger=Dom.get(trigger);panel=Dom.get(panel);if(!trigger||!panel){return }Event.on(trigger,"click",function(e){Event.preventDefault(e);var isVisible=(panel.style.display!="none");panel.style.display=isVisible?"none":"block";if(callback){callback(trigger,panel)}})},checkRefundQueryForm:function(){var pageNum=Dom.get("pageNum");var orderId=Dom.get("orderId");var refundApplyTime=Dom.get("refundApplyTime");var year=Dom.get("yearTo");var monthFrom=Dom.get("monthFrom");var monthTo=Dom.get("monthTo");var refundId=Dom.get("refundId");var refundStatus=Dom.get("refundStatus");var payStatus=Dom.get("payStatus");var interveneStatus=Dom.get("interveneStatus");var askForTime=Dom.get("askForTime");var outTime=Dom.get("outTime");var timeBegin=Dom.get("timeBegin");var timeEnd=Dom.get("timeEnd");var selOrderId=Dom.get("order_id").value;var selRefundApplyTime=(Dom.get("refund-apply-date")).options[(Dom.get("refund-apply-date")).selectedIndex].value;var selYear=Dom.get("year");var selMonthFrom=Dom.get("month-from");var selMonthTo=Dom.get("month-to");var selTimeBegin=Dom.get("bizOrderTimeBegin");var selTimeEnd=Dom.get("bizOrderTimeEnd");if(selYear&&selYear.selectedIndex>-1){var selYear=selYear.options[selYear.selectedIndex].value;year.value=selYear}if(selMonthFrom&&selMonthFrom.selectedIndex>-1){var selMonthFrom=selMonthFrom.options[selMonthFrom.selectedIndex].value;monthFrom.value=selMonthFrom}if(selMonthTo&&selMonthTo.selectedIndex>-1){var selMonthTo=selMonthTo.options[selMonthTo.selectedIndex].value;monthTo.value=selMonthTo}if(selTimeBegin){timeBegin.value=selTimeBegin.value}if(selTimeEnd){timeEnd.value=selTimeEnd.value}var selRefundId=Dom.get("refund_id").value;var selRefundStatus=(Dom.get("J_RefundStatus")).options[(Dom.get("J_RefundStatus")).selectedIndex].value;var selPayStatus=(Dom.get("J_PayStatus")).options[(Dom.get("J_PayStatus")).selectedIndex].value;var selIntervene=(Dom.get("J_Intervene")).options[(Dom.get("J_Intervene")).selectedIndex].value;var selAskForTime="";var selOutTime="";if(Dom.get("J_ApplyTime")){selAskForTime=(Dom.get("J_ApplyTime")).options[(Dom.get("J_ApplyTime")).selectedIndex].value}if(Dom.get("J_OutTime")){selOutTime=(Dom.get("J_OutTime")).options[(Dom.get("J_OutTime")).selectedIndex].value}if(selOrderId!=""){orderId.value=selOrderId}if(selRefundApplyTime!=""){refundApplyTime.value=selRefundApplyTime}if(selRefundId!=""){refundId.value=selRefundId}if(selRefundStatus!=""){refundStatus.value=selRefundStatus}if(selPayStatus!=""){payStatus.value=selPayStatus}if(selIntervene){interveneStatus.value=selIntervene}if(selAskForTime!=""){askForTime.value=selAskForTime}if(selOutTime!=""){outTime.value=selOutTime}},changePage:function(pageNum){var f=document.getElementById("refundListQueryForm");f.pageNum.value=pageNum;f.submit()},gotoPage:function(){Event.on("viewit","click",function(){var trim=function(str){return str.replace(/(^\s*)|(\s*$)/g,"")};var IsInteger=function(varString){var regEx=new RegExp("^-?\\d+$");if(varString.match(regEx)==null){return false}else{return true}};var validate=function(pageNum){var page=trim(pageNum);var max_page=parseInt(Dom.get("totalPage").value);if(page==null||page==""){alert("\u9875\u53f7\u65e0\u6548\uff01");return false}if(!IsInteger(page)){alert("\u9875\u53f7\u5fc5\u987b\u4e3a\u6574\u6570\uff01");return false}page=parseInt(page);if(page>max_page){alert("\u9875\u53f7\u8d85\u51fa\u6700\u5927\u9875\u53f7\uff01");return false}if(page<1){alert("\u9875\u53f7\u8d85\u51fa\u6700\u5c0f\u9875\u53f7\uff01");return false}return true};var toPage=Dom.get("pageNO").value;if(toPage!=""&&validate(toPage)){var f=Dom.get("refundListQueryForm");f.pageNum.value=toPage;f.submit()}})},addRefundSearchEvent:function(){var date=new Date();var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();var calendar=year+"-"+month+"-"+day;var timeBegin="bizOrderTimeBegin";var timeEnd="bizOrderTimeEnd";var yr=Dom.get("year");var maxMonth=month;var monthFrom=Dom.get("month-from");var monthTo=Dom.get("month-to");var outTime=0;var fileName="";var time;var onlineRefundUrl=Dom.get("onlineRefund").value;var archiveRefundUrl=Dom.get("archiveRefund").value;var flag=0;Trade.Util.gotoPage();var bindCalender=function(){TB.widget.SimpleCalendar.init(D.get(timeBegin),null,null,{selected:calendar,enableSelectYear:true});TB.widget.SimpleCalendar.init(D.get(timeEnd),null,null,{selected:calendar,enableSelectYear:true})};bindCalender();var closeBtns=Dom.getElementsByClassName("J_BatchExportPanelCloseBtn");Event.on(closeBtns,"click",function(e){var element=Event.getTarget(e);var parentId=Dom.getAttribute(element,"value");Dom.addClass(parentId,"hidden")});var pageNums=Dom.getElementsByClassName("J_GoToPage");for(var index=0,length=pageNums.length;index<length;index++){Event.on(pageNums[index],"click",function(e){var target=Event.getTarget(e);var pageNum=target.innerHTML;Trade.Util.changePage(pageNum)})}Event.on("J_BatchExportBtn","click",function(e){var loadStatus=["load-tips","loading-now","load-success","making-now","load-failure"];for(var index=0,length=loadStatus.length;index<length;index++){Dom.addClass(loadStatus[index],"hidden")}if(Dom.hasClass("msg-tips","hidden")){Dom.removeClass("msg-tips","hidden");Dom.addClass("J_LoadExportBtn","hidden");Dom.removeClass("J_MakeExportBtn","hidden")}else{Dom.addClass("msg-tips","hidden")}});Event.on("J_RefundStatus","change",function(e){var sel=Event.getTarget(e);var statusValue=sel.options[sel.selectedIndex].value});Event.on("J_PayStatus","change",function(e){var sel=Event.getTarget(e);var payValue=sel.options[sel.selectedIndex].value});Event.on("J_ApplyTime","change",function(e){var sel=Event.getTarget(e);var applyValue=sel.options[sel.selectedIndex].value;var askForTime=Dom.get("askForTime");askForTime.value=applyValue;var form=Dom.get("refundListQueryForm");var timeScale=Dom.get("refund-apply-date");if(applyValue!=0){var outTime=Dom.get("outTime");outTime.value=0}if(timeScale.options[timeScale.selectedIndex].value==0){form.action=onlineRefundUrl}else{form.action=archiveRefundUrl}form.submit()});var roles=Dom.getElementsByClassName("J_ChangeRole");Event.on(roles,"click",function(e){var target=Event.getTarget(e);var role=Dom.getAttribute(target,"value");var form=Dom.get("refundListQueryForm");var userRole=Dom.get("userRole");userRole.value=role;var timeScale=Dom.get("refund-apply-date");var queryStatus=timeScale.options[timeScale.selectedIndex].value;Trade.Util.checkRefundQueryForm();if(queryStatus==1){form.action=archiveRefundUrl}else{form.action=onlineRefundUrl}form.submit()});Event.on("J_OutTime","change",function(e){var sel=Event.getTarget(e);var outValue=sel.options[sel.selectedIndex].value;var outTime=Dom.get("outTime");outTime.value=outValue;var form=Dom.get("refundListQueryForm");var timeScale=Dom.get("refund-apply-date");if(outValue!=0){var askForTime=Dom.get("askForTime");askForTime.value=0}if(timeScale.options[timeScale.selectedIndex].value==0){form.action=onlineRefundUrl}else{form.action=archiveRefundUrl}form.submit()});Event.on("J_SearchOrders","click",function(e){Trade.Util.checkRefundQueryForm();var form=Dom.get("refundListQueryForm");var timeScale=Dom.get("refund-apply-date");if(timeScale.options[timeScale.selectedIndex].value==0){form.action=onlineRefundUrl}else{form.action=archiveRefundUrl}form.submit()});Event.on("J_LoadExportBtn","click",function(e){var target=Event.getTarget(e);var url=Dom.getAttribute(target,"data-export-url");if(fileName==""){Dom.addClass("msg-tips","hidden");Dom.removeClass("load-failure","hidden");return }url=url+"?f_p="+fileName;window.location=url;Dom.removeClass("load-success","hidden");Dom.addClass("msg-tips","hidden")});var checkErrorNumber=function(json){var errorCode="";if(json){errorCode=json.errorCode;if(errorCode!=""){Dom.addClass("making-now","hidden");Dom.removeClass("load-failure","hidden");var failTips=Dom.get("failTips");failTips.innerHTML=errorCode+"<a title='\u5173\u95ed' href='#' class='close-btn J_BatchExportPanelCloseBtn' value='load-failure'>\u5173\u95ed</a>";var closeBtns=Dom.getElementsByClassName("J_BatchExportPanelCloseBtn");Event.on(closeBtns,"click",function(e){var element=Event.getTarget(e);var parentId=Dom.getAttribute(element,"value");Dom.addClass(parentId,"hidden")});return false}}return true};var checkMakeOk=function(url){YAHOO.util.Get.script(url,{onSuccess:function(){var jsonString=window.resultExport;var json=YAHOO.lang.JSON.parse(jsonString);if(json){var exportStatus=json.exportStatus;if(exportStatus=="exporting"){if(time==null){time=setInterval(function(){checkMakeOk(url)},5000)}return }if(exportStatus=="exportSuccess"){clearInterval(time);fileName=json.f_p;if(Dom.hasClass("load-failure","hidden")){Dom.addClass("making-now","hidden");Dom.removeClass("msg-tips","hidden");Dom.addClass("J_MakeExportBtn","hidden");Dom.removeClass("J_LoadExportBtn","hidden")}}if(exportStatus=="exportFail"){clearInterval(time);Dom.addClass("making-now","hidden");if(Dom.hasClass("msg-tips","hidden")){Dom.removeClass("load-failure","hidden");var failTips=Dom.get("failTips");failTips.innerHTML="\u751f\u6210\u62a5\u8868\u5931\u8d25\uff0c\u8bf7\u91cd\u65b0\u5c1d\u8bd5!<a title='\u5173\u95ed' href='#' class='close-btn J_BatchExportPanelCloseBtn' value='load-failure'>\u5173\u95ed</a>";var closeBtns=Dom.getElementsByClassName("J_BatchExportPanelCloseBtn");Event.on(closeBtns,"click",function(e){var element=Event.getTarget(e);var parentId=Dom.getAttribute(element,"value");Dom.addClass(parentId,"hidden")})}return }}},onFailure:function(o){if(time==null){time=setInterval(function(){checkMakeOk(url)},5000)}},timeout:10000,charset:"gbk"})};Event.on("J_MakeExportBtn","click",function(e){var target=Event.getTarget(e);var date=new Date();var time1=date.getTime();Dom.addClass("msg-tips","hidden");Dom.removeClass("making-now","hidden");var url=Dom.getAttribute(target,"data-export-url");var form=Dom.get("refundListQueryForm");Trade.Util.checkRefundQueryForm();var formChilds=Dom.getChildren(form);var urlArray=new Array();for(var index=0,length=formChilds.length;index<length;index++){if(formChilds[index].name!=""&&formChilds[index].name!=null){urlArray.push(formChilds[index].name+"="+formChilds[index].value)}}var urlString=urlArray.join("&");url=url+"?"+urlString;YAHOO.util.Get.script(url,{onSuccess:function(){var jsonString=window.resultReport;var json=YAHOO.lang.JSON.parse(jsonString);if(!checkErrorNumber(json)){return }if(json){var exportId=json.exportId;var sellerId=json.sellerId;var checkUrl=Dom.get("checkExportUrl").value;checkUrl=checkUrl+"?sellerId="+sellerId+"&exportId="+exportId;checkMakeOk(checkUrl)}},onFailure:function(){alert("\u7cfb\u7edf\u7e41\u5fd9\u8bf7\u7a0d\u540e\u518d\u8bd5")},timeout:10000,charset:"gbk"})});for(var i=year;i>=year-8;i--){var option=document.createElement("option");option.value=i;option.innerHTML=i+"\u5e74";yr.appendChild(option);if(i==year){option.selected=true}}var makeOptions=function(y){if(monthFrom.options){monthFrom.options.length=0}if(monthTo.options){monthTo.options.length=0}var yearBox=Dom.get("year");for(var index=0,length=yearBox.length;index<length;index++){if(yearBox.options[index].value==y){yearBox.options[index].selected=true}}if(y==year){for(var i=1;i<=month;i++){var option=document.createElement("option");option.value=i;option.innerHTML=i+"\u6708";if(i==month){option.selected=true}monthFrom.appendChild(option)}if(month==1){var option=document.createElement("option");option.value=month;option.innerHTML=month+"\u6708";option.selected=true;monthTo.appendChild(option)}else{for(var i=2;i<=month;i++){var option=document.createElement("option");option.value=i;option.innerHTML=i+"\u6708";if(i==month){option.selected=true}monthTo.appendChild(option)}}}else{for(var i=1;i<=12;i++){var option=document.createElement("option");option.value=i;option.innerHTML=i+"\u6708";if(i==1){option.selected=true}monthFrom.appendChild(option)}for(var i=2;i<=12;i++){var option=document.createElement("option");option.value=i;option.innerHTML=i+"\u6708";if(i==12){option.selected=true}monthTo.appendChild(option)}}};Event.on("year","change",function(e){var sel=Event.getTarget(e);var y=sel.options[sel.selectedIndex].value;if(y!=year){maxMonth=12}else{maxMonth=date.getMonth()+1}makeOptions(y)});var selectNumber=0;var monthFromChange=function(target){var selectNumber=target.options[target.selectedIndex].value;var defaultValue=0;for(var i=0;i<monthTo.options.length;i++){if(monthTo.options[i].selected){defaultValue=monthTo.options[i].value}}monthTo.options.length=0;for(var i=selectNumber;i<=maxMonth;i++){var option=document.createElement("option");option.value=i;option.innerHTML=i+"\u6708";if(i==defaultValue){option.selected=true}monthTo.appendChild(option)}};Event.on("month-from","change",function(e){var target=Event.getTarget(e);monthFromChange(target)});Event.on("month-to","change",function(e){var target=Event.getTarget(e);var selectNumber=target.options[target.selectedIndex].value;var defaultValue=0;for(var i=0;i<monthFrom.options.length;i++){if(monthFrom.options[i].selected){defaultValue=monthFrom.options[i].value}}monthFrom.options.length=0;for(var i=1;i<=selectNumber;i++){var option=document.createElement("option");option.value=i;option.innerHTML=i+"\u6708";if(i==defaultValue){option.selected=true}monthFrom.appendChild(option)}});Event.on("refund-apply-date","change",function(e){var sel=Event.getTarget(e);var value=sel.options[sel.selectedIndex].value;if(value==0){Dom.addClass("year","hidden");Dom.addClass("month-from","hidden");Dom.addClass("month-to","hidden");Dom.removeClass("bizOrderTimeBegin","hidden");Dom.removeClass("bizOrderTimeEnd","hidden");var elements=Dom.getElementsByClassName("J_DisplayLayer");for(var index=0,length=elements.length;index<length;index++){Dom.removeClass(elements[index],"visible")}}else{Dom.removeClass("year","hidden");Dom.removeClass("month-from","hidden");Dom.removeClass("month-to","hidden");Dom.addClass("bizOrderTimeBegin","hidden");Dom.addClass("bizOrderTimeEnd","hidden");var elements=Dom.getElementsByClassName("J_DisplayLayer");for(var index=0,length=elements.length;index<length;index++){Dom.addClass(elements[index],"visible")}makeOptions(year)}});var applyTimeNode=Dom.get("refund-apply-date");var applyTimeValue=applyTimeNode.options[applyTimeNode.selectedIndex].value;if(applyTimeValue==1){Dom.removeClass("year","hidden");Dom.removeClass("month-from","hidden");Dom.removeClass("month-to","hidden");Dom.addClass("bizOrderTimeBegin","hidden");Dom.addClass("bizOrderTimeEnd","hidden");var yearTo=Dom.get("yearTo").value;var mf=Dom.get("monthFrom").value;var mt=Dom.get("monthTo").value;if(yearTo){var yearSelect=Dom.get("year");for(var index=0,length=yearSelect.options.length;index<length;index++){if(yearSelect.options[index].value==yearTo){yearSelect.options[index].selected=true}}var y=yearSelect.options[yearSelect.selectedIndex].value;if(y!=year){maxMonth=12}makeOptions(yearTo);var monthFromSelect=Dom.get("month-from");var monthFromArrays=new Array();for(var index=0,length=monthFromSelect.options.length;index<length;index++){if(monthFromSelect.options[index]&&monthFromSelect.options[index].value==mf){monthFromSelect.options[index].selected=true}if(monthFromSelect.options[index]&&parseInt(monthFromSelect.options[index].value)>parseInt(mt)){monthFromArrays.push(monthFromSelect.options[index])}}for(var i=0,length=monthFromArrays.length;i<length;i++){if(monthFromArrays[i].nodeType==1){monthFromSelect.removeChild(monthFromArrays[i])}}var monthToSelect=Dom.get("month-to");var monthToArray=new Array();monthFromChange(monthFromSelect);for(var index=0,length=monthToSelect.options.length;index<length;index++){if(monthToSelect.options[index]&&monthToSelect.options[index].value==mt){monthToSelect.options[index].selected=true}if(monthToSelect.options[index]&&parseInt(monthToSelect.options[index].value)<parseInt(mf)){monthToArray.push(monthToSelect.options[index])}}for(var i=0,length=monthToArray.length;i<length;i++){if(monthToArray[i].nodeType==1){monthToArray.removeChild(monthToArray[i])}}}else{makeOptions(year)}}},toggleOrderDetail:function(listTableId){var orders=Dom.getElementsByClassName("hidden-detail","tbody",listTableId);for(var i=0,len=orders.length;i<len;++i){(function(){var order=orders[i];var orderHd=Dom.getElementsByClassName("order-hd","tr",order);Event.on(orderHd,"click",function(e){var clickTag=Event.getTarget(e).tagName;if(clickTag=="INPUT"||clickTag=="A"){return }if(Dom.hasClass(order,"hidden-detail")){Dom.replaceClass(order,"hidden-detail","display-detail")}else{Dom.replaceClass(order,"display-detail","hidden-detail")}})})()}},initUserInfoPopup:function(trigger){if(!trigger||!trigger.getAttribute("data")){return }var img=trigger.getElementsByTagName("img");if(img&&img.length>0){img[0].setAttribute("alt","")}var infoBox=document.createElement("div");Dom.addClass(infoBox,"popup-info-box");var htmlCode='<div class="bl"><div class="br">';htmlCode+='<div class="bd user-info">';htmlCode+="\u6b63\u5728\u52a0\u8f7d\u2026\u2026";htmlCode+="</div>";htmlCode+="</div></div>";htmlCode+='<div class="bt"><div class="corner bt-l"></div><div class="mid"></div><div class="corner bt-r"></div></div>';infoBox.innerHTML=htmlCode;document.body.appendChild(infoBox);TB.widget.SimplePopup.decorate(trigger,infoBox,{offset:[0,-15],position:"right",effect:"fade",disableClick:false,onShow:function(){Dom.setStyle(infoBox,"display","block");if(infoBox.getElementsByTagName("h5").length>0){return }var infoBoxBd=Dom.getElementsByClassName("user-info","div",infoBox)[0];var url=trigger.getAttribute("data");YAHOO.util.Connect.asyncRequest("GET",url,{success:function(o){try{var userInfo=eval("("+o.responseText+")");var htmlCode="<h5>\u8054\u7cfb\u4fe1\u606f</h5>";htmlCode+='<table class="user-info-table"><tbody>';htmlCode+="<tr><th>\u59d3\u540d\uff1a</th><td>"+userInfo.name+"</td></tr>";htmlCode+="<tr><th>\u7535\u8bdd\uff1a</th><td>"+userInfo.tel+"</td></tr>";htmlCode+="<tr><th>\u624b\u673a\uff1a</th><td>"+userInfo.mobile+"</td></tr>";htmlCode+="<tr><th>\u5907\u7528\u7535\u8bdd\uff1a</th><td>"+userInfo.otherPhone+"</td></tr>";htmlCode+="<tr><th>\u7535\u5b50\u90ae\u4ef6\uff1a</th><td>"+userInfo.email+"</td></tr>";htmlCode+="<tr><th>\u57ce\u5e02\uff1a</th><td>"+userInfo.city+"</td></tr>";htmlCode+='<tr class="sep"><td colspan="2"><hr></td></tr>';if(userInfo.message){htmlCode+='<tr><th>\u4e70\u5bb6\u7559\u8a00\uff1a</th><td class="message">'+userInfo.message+"</td></tr>";htmlCode+='<tr class="sep"><td colspan="2"><hr></td></tr>'}var attachCode="";if(userInfo.attachInfo){for(key in userInfo.attachInfo){attachCode+="<tr><th>"+key+"\uff1a</th><td>"+userInfo.attachInfo[key]+"</td></tr>"}}if(attachCode.length>0){htmlCode+=attachCode}htmlCode+="</tbody></table>";var linkCode="";if(userInfo.buyerAddress&&userInfo.buyerAddress.length>0){linkCode+='<a href="'+userInfo.buyerAddress+'" target="_blank">\u67e5\u770b\u6536\u8d27\u5730\u5740</a>'}if(linkCode.length>0){htmlCode+='<div class="view-address">'+linkCode+"</div>"}infoBoxBd.innerHTML=htmlCode}catch(e){infoBoxBd.innerHTML="\u5bf9\u4e0d\u8d77\uff0c\u6682\u65f6\u65e0\u6cd5\u83b7\u5f97\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5\u3002"}},failure:function(){infoBoxBd.innerHTML="\u5bf9\u4e0d\u8d77\uff0c\u6682\u65f6\u65e0\u6cd5\u83b7\u5f97\u6570\u636e\uff0c\u8bf7\u7a0d\u5019\u91cd\u8bd5\u3002"}})}})},initMemoInfo:function(){var memoPopup=document.createElement("div");memoPopup.id="J_MemoPopup";Dom.addClass(memoPopup,"memo-popup");document.body.appendChild(memoPopup);Dom.getElementsByClassName("J_MemoFlag","a","J_ListTable",function(trigger){var text=trigger.getAttribute("title");if(text){trigger.setAttribute("data",text);trigger.setAttribute("title","");trigger.getElementsByTagName("img")[0].setAttribute("alt","")}else{trigger.setAttribute("data","\u6682\u65f6\u6ca1\u6709\u5907\u5fd8\u5f55\u4fe1\u606f")}TB.widget.SimplePopup.decorate(trigger,memoPopup.id,{effect:"fade",autoFit:true,eventType:"mouse",disableClick:false,delay:0.1,position:"left",offset:[25,15],onShow:function(){this.popup.innerHTML=this.trigger.getAttribute("data")},onHide:function(){this.popup.innerHTML=""}})})},initXBCardPopup:function(){var popup=document.createElement("div");popup.id="XBCardPopup";popup.setAttribute("style","background: #fff;width: 602px; display: none; z-index: 999999");popup.innerHTML='<iframe id="XBCardFrame" src="about:blank" width="602" height="302" frameborder="0" scrolling="no"></iframe>';document.body.appendChild(popup);var triggers=Dom.getElementsByClassName("J_XBCard","a","J_ListTable");TB.widget.SimplePopup.decorate(triggers,popup.id,{width:602,height:402,position:"bottom",eventType:"click",offset:[-500,-100],onShow:function(){Dom.get("XBCardFrame").src=this.trigger.href}})},initReasonPopup:function(){var triggers=Dom.getElementsByClassName("J_ViewReason","A",document.body,function(trigger){trigger.setAttribute("data-reason",trigger.title);trigger.title=""});if(0===triggers.length){return }var popup=document.createElement("div");popup.id="ReasonPopup";popup.className="popup-info-box";popup.setAttribute("style","display: none;");var htmlCode='<div class="bl"><div class="br">';htmlCode+='<div class="bd" id="CanceledReason" style="padding:10px 25px 5px 10px;">';htmlCode+="\u53d6\u6d88\u539f\u56e0";htmlCode+="</div>";htmlCode+="</div></div>";htmlCode+='<div class="bt"><div class="corner bt-l"></div><div class="mid"></div><div class="corner bt-r"></div></div>';popup.innerHTML=htmlCode;document.body.appendChild(popup);TB.widget.SimplePopup.decorate(triggers,popup.id,{disableClick:true,offset:[-25,-10],onShow:function(){Dom.get("CanceledReason").innerHTML=this.trigger.getAttribute("data-reason")}})},twinkleErrorBox:function(boxId,duration){var box=Dom.get(boxId);box=Dom.getFirstChild(box);if(!box){return }duration=duration||2;var hasBorder=true;var timer=YAHOO.lang.later(200,null,function(){Dom.setStyle(box,"borderWidth",hasBorder?"0":"1px");hasBorder=!hasBorder},null,true);YAHOO.lang.later(duration*1000,null,function(){Dom.setStyle(box,"borderWidth","1px");timer.cancel()})},parseQueryString:function(string,overwrite,separator){if(!string||!string.length){return{}}var obj={};var pairs=string.split(separator||"&");var pair,name,value;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i].split("=");name=decodeURIComponent(pair[0]);value=decodeURIComponent(pair[1]);if(value===""||value==="undefined"){value=undefined}if(overwrite===true){obj[name]=value}else{if(typeof obj[name]=="undefined"){obj[name]=value}else{if(typeof obj[name]=="string"){obj[name]=[obj[name]];obj[name].push(value)}else{obj[name].push(value)}}}}return obj}},PageInit:function(pageId){if(pageId=="list-sold-items"||pageId=="list-bought-items"){initTradeSearchBox();new Trade.ListSelector("J_ListTable");Dom.getElementsByClassName("J_UserInfo","span","J_ListTable",function(trigger){Trade.Util.initUserInfoPopup(trigger)});Trade.Util.initMemoInfo()}if(pageId=="list-bought-items"){Trade.Util.initXBCardPopup()}if(pageId=="list-sold-items"){Trade.Util.togglePanel("J_BatchExportBtn","J_BatchExportPanel");Trade.Util.togglePanel("J_BatchExportPanelCloseBtn","J_BatchExportPanel")}Trade.Util.addRefundSearchEvent();if(pageId=="trade-order-detail"){var stab=TB.widget.SimpleTab.decorate("J_TabView",{eventType:"mouse",currentClass:"current",tabPanelClass:"info-box"});var hash=location.hash;if(hash&&hash.length==5){var tabIndex=hash.substring(4);stab.switchTab(tabIndex)}Trade.Util.initReasonPopup()}if(pageId=="list-sold-items"||pageId=="list-bought-items"||pageId=="trade-order-detail"){var triggers=Dom.getElementsByClassName("J_DialogTrigger","*",document.body);if(triggers.length==0){return }var loader=new Y.YUILoader({require:["container"],base:"http://a.tbcdn.cn/yui/2.6.0/build/",onSuccess:function(){Trade.DialogMgr.initTriggers()},onFailure:function(o){alert("error: "+YAHOO.lang.dump(o))}});loader.insert()}if(pageId=="modify-price"){Trade.TradeOperations.ModifyPrice(document.forms.modifyPriceForm)}if(pageId=="cancel-order"){Trade.TradeOperations.CancelOrder(document.forms.cancelOrderForm)}if(pageId=="modify-price"||pageId=="cancel-order"||pageId=="delay-trade"||pageId=="batch-pay"){Trade.DialogMgr.initDialogCloseBtn()}if(pageId=="my-point"){initTradeSearchBox()}if(pageId=="refund-list"){initRefundHelpBox()}function initTradeSearchBox(){Trade.Util.togglePanel("J_SearchBoxToggle","J_SearchBox",function(trigger){if(Dom.hasClass(trigger,"collapsed-tool-toggle")){Dom.removeClass(trigger,"collapsed-tool-toggle")}else{Dom.addClass(trigger,"collapsed-tool-toggle")}})}function initRefundHelpBox(){Trade.Util.togglePanel("J_RefundHelpBoxToggle","J_RefundHelpBox",function(trigger){var panel=trigger.parentNode;if(Dom.hasClass(panel,"collapsed")){Dom.removeClass(panel,"collapsed")}else{Dom.addClass(panel,"collapsed")}})}}}}());KISSY.add("core/config",function(a){function j(a,b){return a.indexOf(b)!=-1}var b=a.DOM,c="gbk",d=j(location.href,"ks-debug"),e=j(location.host,"taobao.com"),f=d?a.now():"",g="http://"+(e?"a.tbcdn.cn":"assets.daily.taobao.net"),h=d?"1.0":b.attr("#J_MainScript","data-catalog"),i=g+"/apps/tradeface/trademanager/confirm/"+h;a.config({packages:[{name:"core",path:i,tag:f,charset:c},{name:"utils",path:i,tag:f,charset:c},{name:"mods",path:i,tag:f,charset:c}]})});