KISSY.add("cookie",function(b){function c(b){return"string"===typeof b&&""!==b}var p=document,l=encodeURIComponent,k=decodeURIComponent;b.Cookie={get:function(b){var h,j;if(c(b)&&(j=p.cookie.match("(?:^| )"+b+"(?:(?:=([^;]*))|;|$)")))h=j[1]?k(j[1]):"";return h},set:function(b,h,j,k,v,A){var h=l(h),r=j;"number"===typeof r&&(r=new Date,r.setTime(r.getTime()+864E5*j));r instanceof Date&&(h+="; expires="+r.toUTCString());c(k)&&(h+="; domain="+k);c(v)&&(h+="; path="+v);A&&(h+="; secure");p.cookie=b+"="+
h},remove:function(b){this.set(b,"",0)}}});KISSY.add("ajax",function(b){var c=document,p=b.UA;b.Ajax={request:function(){b.error("not implemented")},getScript:function(l,k,y){var h=c.getElementsByTagName("head")[0]||c.documentElement,j=c.createElement("script");j.src=l;y&&(j.charset=y);j.async=!0;b.isFunction(k)&&(p.ie?j.onreadystatechange=function(){var b=j.readyState;if(b==="loaded"||b==="complete"){j.onreadystatechange=null;k()}}:j.onload=k);h.appendChild(j)}}});
(function(){var b=KISSY,c=b.DOM,p=b.Event,l=b.Cookie,k=b.UA,y=b.Ajax,h=window,j=document,u=encodeURIComponent,v=decodeURIComponent,A=b.now(),r=unescape((l.get("_nk_")||"").replace(/\\u/g,"%u")),q="x",B,F=h.g_config||{},G=0,w=function(){var a=location.hostname;-1<a.indexOf("tmall.com")?(a="tmall.com",q="otherx"):0<a.indexOf("daily.tmall.net")?(a="daily.tmall.net",q="otherx"):a=0<a.indexOf("taobao.net")?"taobao.net":"taobao.com";return a}(),C;C=/daily/i.test(location.host)?"daily.taobao.net":"taobao.com";
var D=6,J=6===(h.g_config||0).appId,H="http://amos.alicdn.com/muliuserstatus.aw?beginnum=0&site=cntaobao&charset=utf-8&uids=",K="http://amos.alicdn.com/getRealCid.aw?fromId=cntaobao"+u(r)+"&toId=",L="http://www.atpanel.com/ww?cache="+A,I={SNS:"\u6211\u5728\u7ebf\uff0c\u548c\u6211\u804a\u804a\u5427~",DEFAULT:"\u70b9\u6b64\u53ef\u4ee5\u76f4\u63a5\u548c\u5356\u5bb6\u4ea4\u6d41\u9009\u597d\u7684\u5b9d\u8d1d\uff0c\u6216\u76f8\u4e92\u4ea4\u6d41\u7f51\u8d2d\u4f53\u9a8c\uff0c\u8fd8\u652f\u6301\u8bed\u97f3\u89c6\u9891\u5662\u3002"},
z=["ie","firefox","chrome","safari","opera"];location.hostname.indexOf("tmall");var M=[1,2,10,8,12,12,12],E={addonIsOK:function(){b.isBoolean(B)||(B=this._checkWangWangInstalled());return-1<location.href.indexOf("topen")?!1:B},data:{},lightedUsers:[],init:function(){c.addStyleSheet(".ww-light{overflow:hidden;}.ww-block{display:block;margin-top:3px;}.ww-inline{display:inline-block;vertical-align:text-bottom;}.ww-light a{background:url(http://img04.taobaocdn.com/tps/i4/T1UPFAXnNfXXXXXXXX-130-60.gif) no-repeat 0 0;text-decoration:none!important;width:20px;height:20px;zoom:1;}.ww-large a{width:67px;}a.ww-offline{background-position:0 -20px;}a.ww-mobile{background-position:0 -40px;}.ww-small .ww-online{background-position:-80px 0;}.ww-small .ww-offline{background-position:-80px -20px;}.ww-small .ww-mobile{background-position:-80px -40px;}.ww-static .ww-online{background-position:-110px 0;}.ww-static .ww-offline{background-position:-110px -20px;}.ww-static .ww-mobile{background-position:-110px -40px;}.ww-light a span{display:none;}");
this.light();for(var a=0,f=z.length;a<f;++a)if(b.UA[z[a]]){G=z[a]+b.UA[z[a]];break}},initStart:function(){if(!J){var a=b.unparam(location.search.substring(1));("g_config"in h&&"appId"in h.g_config&&-1!=h.g_config.appId||"tstart"in a||"tdog"in a)&&b.ready(function(){var a=j.getElementsByTagName("head")[0]||j.documentElement;j.createElement("link");var b=j.createElement("script"),d;d=2;var e;e=location.hostname;var c=e.split("."),h=c.length;2>=h?d=e:(d=d||1,d>h-2&&(d=h-2),d=c.slice(d).join("."));e=
"http://"+(!/daily/i.test(location.host)?"a.tbcdn.cn":"assets.daily.taobao.net")+"/p/header/adapter-min.js?t="+Math.floor((new Date).getTime()/36E5);"etao.com"!=d&&(b.src=e,a.insertBefore(b,a.firstChild))})}},light:function(a){function f(a){g(s[a],n[a],p[a],function(){q++;q<x&&f(++a)})}function g(a,f,e,g){h.online=[];b.io?b.io({dataType:"jsonp",url:H+a.join(";"),data:{},jsonp:"callback",success:function(a){var c=a.data;a.success&&(b.each(f,function(a,f){0==b.query("a",a).length&&d._lightToken(a,e[f],
c[f])}),g&&g())}}):b.Ajax.getScript(H+a.join(";"),function(){b.each(f,function(a,f){0==b.query("a",a).length&&d._lightToken(a,e[f],h.online[f])});g&&g()},"utf-8")}var a=b.get(a)||j.body,d=this,a=b.query(".J_WangWang",a),e=a.length;if(0!==e){var c=[],l=[],o,m;for(m=0;m<e;++m)o=d._getParamsFromData(a[m]),c.push(o),o=o.nick,l.push(u(o));var n=[],s=[],p=[],t="",x=o=0;for(m=0;m<e;++m){if(k.ie&&1800<(t+l[m]).length||100<=m||m===e-1)t=m===e-1?e:m,s[x]=l.slice(o,t),n[x]=a.slice(o,t),p[x]=c.slice(o,t),t="",
o=m,x++;t+=l[m]+";"}f(0);var q=0}},_lightToken:function(a,f,g){var d=this,e=c.create('<a href="javascript: void(0);" target="_blank"></a>'),j=f.encode?v(f.nick):f.nick,k=f.from+j,o=f.item,m=f.items,n=f.portal,s=k;o&&(s+="-{"+o+"}");d.data[s]={key:s,userName:j,userId:k,fromSite:f.from,status:M[g],itemId:o,itemsId:m,portalId:n};a.className="ww-light ww-"+f.icon;e.className="ww-"+f.display;1===g?(c.addClass(e,"ww-online"),e.title=I.DEFAULT,F.appId&&4==F.appId&&(e.title=I.SNS),e.innerHTML="<span>\u65fa\u65fa\u5728\u7ebf</span>"):
4===g||5===g?(c.addClass(e,"ww-mobile"),e.innerHTML="<span>\u624b\u673a\u5728\u7ebf</span>"):(c.addClass(e,"ww-offline"),e.innerHTML="<span>\u65fa\u65fa\u79bb\u7ebf</span>");e.href="http://www.taobao.com/webww/?ver=1&"+d._paramUserInfo(d.data[s],!0);p.on(e,"click",function(a){var f=b.unparam(l.get(q)),c=d.data[s],j=unescape((l.get("_nk_")||"").replace(/\\u/g,"%u"));(d.addonIsOK()||f&&f.e==1)&&a.preventDefault();if(!d.addonIsOK()){a.preventDefault();if(d._isOtherHost()){alert("\u4f60\u6ca1\u6709\u5b89\u88c5\u963f\u91cc\u65fa\u65fa,\u8bf7\u4e0b\u8f7d\u963f\u91cc\u65fa\u65fa!");
window.open("http://www.taobao.com/wangwang")}else if(j==""){w.indexOf("tmall")>-1?d._directToTBLogin(c.key):d._openTBLoginPopup(c.key);return}}!c.dispatched&&g<4&&c.userId.indexOf(":")==-1?y.getScript(K+u(c.userId)+"&charset=utf-8",function(){var a=v(h.realcid);if(a&&a!==c.userId){c.userName=a.substring(8);c.userId=a}c.dispatched=true;d._openChatDialog(c,e)},"utf-8"):d._openChatDialog(c,e)});a.appendChild(e)},_setCookie:function(){l.set(q,b.param(cookieX),365,w,"/")},_directToTBLogin:function(a){var f=
location,c=f.protocol+"//"+f.host+f.pathname,d=f.search,e=f.hash,h="https://login."+C+"/member/login.jhtml?f=top",d=d?b.unparam(d.substring(1)):{};"wwlight"in d&&delete d.wwlight;a&&(d.wwlight=a);d=b.param(d);d=u(d);f.href=h+"?redirectUrl="+(c+"?"+d+e)},_openTBLoginPopup:function(a){function f(a){c.css(a,"left",parseInt(c.viewportWidth()/2)-parseInt(n.offsetWidth/2)+"px");c.css(a,"top",parseInt(c.viewportHeight()/2)-parseInt(n.offsetHeight/2)+(6===b.UA.ie?c.scrollTop():0)+"px")}var g=location,d=g.protocol+
"//"+g.host+g.pathname,e=g.search,h=g.hash,j=g.href,k=-1<location.hostname.indexOf("taobao.com"),m,e=e?b.unparam(e.substring(1)):{};"wwlight"in e&&delete e.wwlight;a&&(e.wwlight=a,this.isSearch()&&(m=e.q,delete e.q),e.wwlight=a);e=b.param(e);this.isSearch()&&m&&(e="q="+m+"&"+e);j=d+"?"+e+h;g=location;c.addStyleSheet(".tstart-login{width:410px;height:300px;bottom:100px;left:200px;opacity:1;position:fixed;_position:absolute;z-index:5000;background-color:#fff;padding:0;overflow:hidden;-moz-border-radius-bottomleft:5px;-moz-border-radius-bottomright:5px;-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px;border:7px solid #BBB;}.tstart-login .hd{height:22px;line-height:22px;padding-left:8px;border-bottom:1px solid #D1D1D1;font-weight:bold;background-color:#fff;}.tstart-login .ft{background-color:#F5F5F5;}.tstart-login .ft .btn-close{color:#C9C9C9;font-family:Tahoma,sans;font-size:12px;font-weight:bold;position:absolute;right:8px;text-decoration:none;top:3px;}");
var n=b.get(".tstart-login");if(n)c.css(n,"display","block"),f(n);else{n=b.DOM.create('<div id="tstartLogin" class="tstart-login"><div class="hd"><h3></h3></div><div class="bd" style="padding: 0px; overflow: hidden;"><iframe width="410" height="270" frameborder="0" scrolling="no" id="frameContent" name="frameContent" ></iframe></div><div class="ft"><a class="btn-close" title="\u5173\u95ed\u6b64\u7a97\u53e3" href="javascript:void(0)">x</a></div></div>');document.body.appendChild(n);f(n);p.on(b.get(".btn-close",
n),"click",function(){c.css(n,"display","none")});if(6===b.UA.ie)p.on(window,"scroll resize",function(){f(n)});else p.on(window,"scroll resize",function(){c.css(n,"left",parseInt(c.viewportWidth()/2)-parseInt(n.offsetWidth/2)+"px")});a="https://login."+C+"/member/login.jhtml?style=mini&full_redirect=false&redirect_url="+(k?"http://www.taobao.com/go/act/share/loginsuccess.php":"http://www.daily.taobao.net/go/act/share/loginsuccess.php");g=n.getElementsByTagName("iframe")[0];g.src=a;p.on(g,"load",function(){if(l.get("_l_g_"))location.href=
j})}},_isOtherHost:function(){var a=location.hostname,b=["tmall.net","tmall.com","taobao.com","daily.taobao.net"],c=b.length;for(i=0;i<c;i++)if(-1<a.indexOf(b[i]))return!1;return!0},isSearch:function(){var a="search.taobao.com,sandbox.search.taobao.com,search8.taobao.com,search8.daily.taobao.net,s.taobao.com,list.mall.daily.taobao.net,list.mall.taobao.com,s8.taobao.com".split(","),b,c=a.length,d=location;for(b=0;b<c;b++)if(d.host.indexOf(-1<a[b]))return!0},_paramUserInfo:function(a,b,c){var d=a.userId||
a.siteid+a.touid,e="";b&&(d=u(d));if(6!=D)return"uid="+d.split("cntaobao")[1]+"&tositeid="+a.fromSite+"&status="+a.status+"&suid="+a.portalId;c&&c.parentNode&&(e=c.parentNode.getAttribute("data-items")||"");return"&touid="+d+"&siteid="+(a.fromSite||a.siteid)+"&status="+a.status+"&portalId="+(a.portalId||"")+"&gid="+(a.itemId||"")+"&itemsId="+e},_openChatDialog:function(a,c){var g=1,d=b.unparam(l.get("x"));if(this.addonIsOK()){if(6!=D)h.location="wangwang:SendIM?"+this._paramUserInfo(a,null,c);else try{(new ActiveXObject("AliIMX.WangWangX")).ExecCmd("Aliim:sendmsg?"+
this._paramUserInfo(a,null,c))}catch(e){h.location="aliim:sendmsg?"+this._paramUserInfo(a,null,c)}g=0}else d&&1==d.e&&TDog.EventCenter&&(this._isOtherHost()||TDog.EventCenter.fire(TDog.EVENTS.CLICK_LIGHT_ICON,{userInfo:a}),g=2);g=L+"&uid="+r+"&tid="+a.userId+"&gid="+a.itemId+"&ver="+g+"&browse="+G+"&playform="+navigator.platform;try{(new Image).src=g}catch(j){}},_checkWangWangInstalled:function(){var a=!1,c=b.unparam(l.get(q));if(-1<navigator.platform.indexOf("Mac")){if(k.firefox||k.chrome||k.opera||
k.safari)if(g=navigator.mimeTypes["application/ww-plugin"])d=j.createElement("embed"),d.setAttribute("type","application/ww-plugin"),b.DOM.css(d,"visibility","hidden"),b.DOM.css(d,"width",0),b.DOM.css(d,"height",0),j.body.appendChild(d),d.isMacWWInstalled()&&(a=!0),d.parentNode.removeChild(d),c.c=0,l.set(q,b.param(c),365,w,"/")}else if(1==c.c&&(a=!0),!a&&k.ie)a=this._checkWangWangVersion();else if(k.firefox||k.chrome){var g=navigator.mimeTypes["application/ww-plugin"];if(g){var d=j.createElement("embed");
d.setAttribute("type","application/ww-plugin");b.DOM.css(d,"visibility","hidden");b.DOM.css(d,"width",0);b.DOM.css(d,"height",0);KISSY.ready(function(b){j.body.appendChild(d);numberify=function(a){var b=0;return parseFloat(a.replace(/\./g,function(){return 0===b++?".":""}))};a=d.NPWWVersion&&1.003<=numberify(d.NPWWVersion())?!0:!1;"embed"==d.tagName.toLowerCase()&&d.parentNode.removeChild(d);c.c=0;l.set(q,b.param(c),365,w,"/")})}}a&&(c.c=1,l.set(q,b.param(c),365,w,"/"));-1<location.href.indexOf("topen")&&
(a=!1);return a},_checkWangWangVersion:function(){var a=!0,c=b.unparam(l.get(q));try{new ActiveXObject("aliimx.wangwangx")}catch(g){try{new ActiveXObject("WangWangX.WangWangObj"),D=5}catch(d){k.ie&&(c.c=0,a=!1,l.set(q,b.param(c),365,w,"/"))}}finally{}return a},_getParamsFromData:function(a){var b=c.attr(a,"data-encode")||!1,g=c.attr(a,"data-nick")||"";b&&(g=v(g));return{nick:g,item:c.attr(a,"data-item")||(h.g_config||{}).itemId||"",items:c.attr(a,"data-items")||"",display:c.attr(a,"data-display")||
"inline",icon:c.attr(a,"data-icon")||"large",from:c.attr(a,"data-from")||"cntaobao",portal:c.attr(a,"data-portal")||"",fromId:c.attr(a,"data-portal")||"",encode:u}}};window.Light=E;b.ready(function(){E.initStart();E.init()})})();